---
layout: single
title:  "입출력 스트림"
folder: "java"
categories:
  - java
permalink: categories/java/9
toc: true
toc_sticky: true
sidebar_main: true
published: true
---

## 입출력 스트림
자바 프로세스에서 외부(일반적으로 파일) 또는 그 반대로 데이터를 주고받을 수 있는데, 이에 사용되는 통로를 입출력 스트림(IO Stream)이라 한다. 스트림은 단방향이기 때문에 사용자 본인 관점을 기준으로 Input, OutputStream(이하 기본 스트림)을 구분한다.

용도에 따라 각 Stream을 상속받은 여러 가지 스트림을 사용할 수 있다. 예를 들어, 파일 입출력을 원하는 경우 FileStream, 네트워크 통신을 한다면 SocketStream을 선택하면 된다. 물론 각 스트림마다 입력, 출력이 따로 구현되어 있다.

기본 스트림을 인자로 받아 더 편리한 기능을 제공하는 스트림(이하 보조 스트림)이 몇 가지 있다. 기본 스트림은 항상 바이트 단위로 데이터를 처리하는데, Reader, Writer 스트림은 문자열을 그대로 입력받아 바로 전송할 수 있다. 보내거나 받고 싶은 문자열을 바이트 단위로 변환하는 수고로움을 더는 셈이다. 물론 내부적으로 기본 스트림을 호출하므로, 외부 경로나 문자 집합 등의 필요한 정보는 변함없이 입력해야 한다. 예를 들어, 파일에 문자열을 쓰거나 읽을 때는 다음과 같이 사용한다.

```java
public FileWriter(String fileName, Charset charset) throws IOException {
    super(new FileOutputStream(fileName), charset);
}

public FileReader(String fileName, Charset charset) throws IOException {
    super(new FileInputStream(fileName), charset);
}
```

<br>
Buffered Reader, Writer 스트림은 Reader, Writer 스트림에 버퍼 기능이 추가된 스트림이다.

```java
FileWriter fw = new FileWriter(FILE_NAME, UTF_8); // file path, charset
BufferedWriter bw = new BufferedWriter(fw, BUFFER_SIZE); // FileWriter, buffer size

public BufferedWriter(Writer out, int sz) {
    this(out, sz, sz);
}
```

<br>
정리하면, 기본 스트림은 파일·메모리·콘솔 등 실제 데이터에 직접 접근할 수 있으며 단독 사용이 가능하다.
보조 스트림은 단독으로 사용할 수 없고 반드시 대상이 되는 기본 스트림에 연결해야 한다.

```
기본 스트림 :
`FileInputStream` , `FileOutputStream` , `FileReader` , `FileWriter` ,
`ByteArrayInputStream` , `ByteArrayOutputStream`

보조 스트림 :
`BufferedInputStream` , `BufferedOutputStream` , `InputStreamReader` ,
`OutputStreamWriter` , `DataOutputStream` , `DataInputStream` , `PrintStream`
```

## DataOutputStream의 writeUTF(), readUTF()
OutputStream을 인자로 받는 DataOutputStream은 writeUTF(), writeInt()를 통해 타입이 정해진 데이터를 외부로 쓸 수 있다. 문제는 외부 데이터를 불러올 때, DataInputStream의 readUTF()는 어떻게 사용자가 쓴 문자열의 끝을 정확히 구분해 불러올 수 있는 걸까?

writeInt(), writeDouble()처럼 자료형의 크기가 정해진 경우에는 해당 크기만큼의 데이터만 외부로 쓴다. 그러나 UTF-8 형식으로 문자를 저장하는 writeUTF()는 2 byte를 추가로 사용해 글자의 길이(2 byte이므로 65535까지만 사용 가능)를 앞쪽에 저장한다. 따라서 readUTF()를 호출해 문자를 읽어들일 때, 먼저 앞의 2 byte로 글자의 길이를 확인한 후 해당 길이만큼 문자를 읽어들인다.

정리하면 writeXXX()를 호출하는 순간, 이 데이터가 몇 바이트를 차지하는지가 이미 스트림에 정확히 기록된다. 그리고 대응되는 readXXX() 메서드는 그 규칙에 맞춰 정확히 해당 바이트 수만 읽은 뒤 스트림 포인터를 다음 데이터 위치로 이동시켜 출력을 계속 진행한다.
---
layout: single
title:  "HTTP 메서드를 활용한 API 설계 예시"
folder: "network"
categories:
  - network
permalink: categories/network/network002
tags: NETWORK
toc: true
toc_sticky: true
sidebar_main: true
published: true
---

## URL 구조
URI(Uniform Resource Identifier)는 네트워크 내 리소스를 식별하기 위한 통합 규약이다.

URI는 크게 위치(주소)로 식별하는 URL(Uniform Resource Locator)과 이름으로 식별하는 URN(Uniform Resource Name)으로 나눌 수 있지만, URN 만으로 실제 리소스를 찾는 방법은 보편화되지 않아 현재 대부분의 웹 환경에서는 URL을 사용한다. 일반적으로 URI는 URL을 가리키는 의미로 쓰인다.

URL의 기본 문법은 `scheme://[userinfo@]host[:port][/path][?query][#fragment]`와 같이 정해져 있다. 그중 userinfo와 port는 scheme에 따라 정해지는 값이므로 대부분 생략한다.

scheme에는 프로토콜이 들어간다. 웹 브라우저에서의 요청과 응답은 대부분 HTTP를 통해 진행되므로 HTTP, HTTPS가 scheme에 들어간다. port는 scheme에 따라 HTTP는 80, HTTPS는 443으로 정해진다. 물론 URL에서는 생략된다.

host에는 IP 주소도 사용할 수 있지만 일반적으로 도메인 주소가 들어간다. 이어서 \'/\'로 시작되는 path는 리소스가 위치한 경로가 계층적으로 구현되어 있으며, \'?\' 이하의 쿼리를 통해 리소스 필터링을 진행한다. 쿼리는 key = value 형식으로 작성되며, &로 필터링 조건을 추가할 수 있다. query parameter, query string으로도 불린다.

## 웹 브라우저 요청 흐름
웹 브라우저가 서버에 [https://www.google.com/search?q=hello&hl=ko](https://www.google.com/search?q=hello&hl=ko)를 입력하면 어떤 과정을 거치게 될까? 클라이언트는 먼저 google.com의 IP 주소를 DNS 서버를 통해 조회한다. query parameter가 존재한다면 추가적인 리소스 필터링을 수행한다.

이후 생성된 HTTP 요청 메시지(리소스 조회에는 GET 메서드가 사용된다)가 소켓 라이브러리를 거쳐 전송, 네트워크 계층으로 이동한다. TCP/IP로 패키징 된 후 데이터 링크, 물리 계층을 통해 최종적으로 서버로 패킷을 보낸다. 서버로부터 응답 번호가 200인 메시지를 받았다면 응답 메시지 본문에 있는 웹 브라우저 HTML을 렌더링 후 클라이언트 화면으로 해당 리소스를 보이게 한다.

## HTTP 메서드
HTTP란 Hypertext Transfer Protocol의 약자로 HTML 문서를 주고받기 위한 통신 규약으로 시작하였지만, 현재는 이미지, 음성, 파일, JSON, XML 형식의 API를 포함한 대부분의 데이터를 전송, 전달을 돕는 프로토콜로 사용되고 있다.

HTTP는 요청과 응답 메시지로 나뉘는데, 그중 요청 메시지에 HTTP 메서드가 사용된다. 주요 메서드는 다음과 같다.

```
GET: 리소스 조회
POST: 요청 데이터 처리, 주로 등록에 사용
PUT: 리소스를 대체, 해당 리소스가 없으면 생성
PATCH: 리소스 부분 변경
DELETE: 리소스 삭제
```

## 데이터를 전송하는 방식
HTTP 메서드를 사용해 클라이언트에서 서버로 데이터를 전달하는 방식에는 크게 2가지가 있다. 앞서 설명한 query marameter를 통한 데이터 전송 방식과, 메시지 본문(바디)를 통한 데이터 전송이 그것이다.

GET 메서드는 주로 query parameter를 사용해 서버에게 데이터를 요청, 전달하며, POST, PUT, PATCH 메서드는 메시지 바디에 원하는 데이터를 추가해 전송 기능을 수행할 수 있다. 이처럼 HTTP는 특정 상황, 메서드마다 다른 방식으로 데이터를 전달할 수 있다.

## 상황별 메서드 선택과 API 설계
가장 단순한 이미지, 정적인 텍스트 문서와 같은 데이터(쿼리 파라미터가 사용되지 않아도 되는 상황)를 조회할 때에는 일반적으로 GET 메서드만을 사용해 리소스를 조회한다. 동적 데이터를 조회하는 경우에는 GET 메시지의 요청 대상에 쿼리 파라미터가 추가하기만 하면 된다.

HTML Form을 통해 데이터를 전송하는 경우도 있는데, GET과 POST 메서드만 지원한다. 먼저, 폼을 통해 데이터를 등록, 처리하는 요청 메시지에는 POST 메서드가 사용된다. Content-Type: application/x-www-form-urlencoded 헤더가 추가되며, 메시지 본문에 등록, 처리할 데이터가 작성된다.

한편, HTML Form에서 GET 메서드를 사용할 때는 메시지 내 요청 대상이 리소스 변경이 발생할 가능성이 있는 경로를 포함하지 않도록 주의해야 한다. 따라서 GET을 사용하는 폼의 기능은 클라이언트로부터 입력받은 데이터로 필터링 된 리소스를 조회하는 용도로 한정하는 것이 일반적이다.

폼에서 단순한 자료형 데이터가 아닌 바이너리 파일을 입력받아 전송해야 할 경우도 발생하는데, 폼 내부에 enctype="multipart/form-data"를 추가하면 된다. 요청 메시지에는 Content-Type: multipart/form-data; boundary=-----XXX 헤더가 자동으로 추가되며, 메시지 바디에서 폼으로부터 받아오는 모든 데이터를 바운더리로 구분한다. 여기서 -----XXX는 예시일 뿐, 실제로는 브라우저가 랜덤으로 생성한 문자열을 바운더리로 사용한다.

마지막으로 HTTP API를 통해 데이터를 전송하는 방법이 있다. Content-Type: application/json 헤더를 추가한 후, HTTP 주요 메서드를 통한 API를 직접 설계하여 데이터를 주고받는 방식이다.

설계 방식은 크게 POST 기반 등록(컬렉션), PUT 기반 등록(스토어)으로 나눌 수 있다. POST 기반 등록은 클라이언트가 보내는 리소스가 등록된 새로운 URI를 서버가 생성한다. 예를 들어 POST /members?name=park&age=28 HTTP/1.1처럼 클라이언트가 요청 라인을 보냈다면, 응답 메시지는 HTTP/1.1 201 Created 상태 라인과 함께 Location: /members/100이라는 헤더를 추가로 보낸다. 여기서 /100이 서버가 생성한 새 리소스 URI인 셈이다. 이와 같이 서버가 관리하는 리소스 디렉터리를 컬렉션(Collection)이라 한다.

반면, PUT 기반 등록은 클라이언트가 리소스 URI를 사전에 알고 있어야 서버로 데이터를 전송할 수 있다. PUT은 요청 메시지의 내용으로 특정 URI의 리소스를 완전히 덮어쓰는 기능이기 때문에, 어찌 보면 URI를 알고 있어야 하는 것이 당연하다. 이처럼 클라이언트가 관리하는 자원 저장 방식을 스토어(Store)라고 부른다.

마지막으로 HTML FORM을 활용한 API 설계는 GET, POST로 메서드가 제한되기 때문에 조회, 등록 외에 특별한 기능을 구현하려면 control URL을 정의해 상세 API를 완성해야 한다.
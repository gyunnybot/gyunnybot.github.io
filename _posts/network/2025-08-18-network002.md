---
layout: single
title:  "HTTP 메서드를 활용한 API 설계 예시"
folder: "network"
categories:
  - network
permalink: categories/network/network002
tags: NETWORK
toc: true
toc_sticky: true
sidebar_main: true
published: true
---

## URL 구조
URI(Uniform Resource Identifier)는 리소스를 식별할 수 있는 통일된 방식을 말한다. URI는 크게 주소의 위치로 구분하는 URL, 이름으로 구분하는 URN으로 분류할 수 있지만, URN 이름만으로 실제 리소스를 찾을 수 있는 방법이 보편화 되지 않아 대부분 URL을 사용한다. 다시 말해 URI는 URL을 가리키는 용어라고 해도 무방하다.

URL의 기본 문법은 scheme://[userinfo@]host[:port][/path][?query][#fragment]와 같이 정해져 있다. 그 중 userinfo와 port는 scheme에 따라 정해지는 값이므로 대부분 생략한다.

scheme에는 프로토콜이 들어간다. 웹 브라우저에서의 요청과 응답은 주로 HTTP를 통해 발생하므로 HTTP, HTTPS가 scheme에 들어간다. port는 scheme에 따라 HTTP는 80, HTTPS는 443으로 정해진다. 물론 URL에서는 생략한다.

host에는 IP 주소도 사용할 수 있지만 일반적으로 도메인 주소가 들어간다. 또한 \'/\'로 시작되는 path는 리소스가 위치한 경로가 계층적으로 구현되어 있으며, \'?\' 이하의 쿼리를 통해 리소스 필터링을 진행한다. key - value 형식으로 작성되며 &로 필터링 조건을 추가할 수 있다. query parameter, query string 등으로 불린다.

## 웹 브라우저 요청 흐름
웹 브라우저가 서버에 https://www.google.com/search?q=hello&hl=ko를 입력하면 어떤 과정을 거치게 될까? 먼저 google.com의 IP 주소를 DNS 서버를 통해 조회할 것이다. query parameter를 통해 추가적인 리소스 필터링을 수행한다. 이후 HTTP 요청 메세지(리소스 조회에는 GET 메서드가 사용된다)를 만든 후 소켓 라이브러리를 통해 TCP/IP로 패키징하는 과정을 거쳐 서버에 패킷을 보낸다. 서버로부터 응답 번호가 200인 응답 메세지 패킷을 받았다면 메세지 본문에 있는 웹 브라우저 HTML을 렌더링해 화면으로 해당 리소스가 보여지게 된다.

## HTTP 메서드
HTTP란 Hypertext Transfer Protocol의 약자로, 웹에서 HTML 문서를 주고받기 위한 통신 규약으로 시작하였지만, 현재는 이미지, 음성, 파일, JSON, XML 형식의 API를 포함한 대부분의 데이터를 전송, 전달을 가능하게 하는 프로토콜이다.

HTTP는 요청과 응답 메세지로 나뉘는데, 그 중 요청 메세지에 HTTP 메서드가 사용된다. 주요 메서드는 다음과 같다.

```
• GET: 리소스 조회
• POST: 요청 데이터 처리, 주로 등록에 사용
• PUT: 리소스를 대체, 해당 리소스가 없으면 생성
• PATCH: 리소스 부분 변경
• DELETE: 리소스 삭제
```

## HTTP 메서드를 통한 데이터 전송 방식
HTTP 메서드를 사용해 클라이언트에서 서버로 데이터를 전달하는 방식에는 크게 2가지가 있다. 앞서 설명한 query marameter를 통한 데이터 전송 방식과, 메세지 바디를 통한 데이터 전송이 그것이다. GET 메서드는 주로 query parameter를 사용해 서버에게 데이터를 요청, 전달하며, POST, PUT, PATCH 메서드는 메세지 바디에 원하는 데이터를 추가해 기능을 수행할 수 있다. 특정 상황마다 다른 방식을 사용할 수 있다.

## 상황에 따른 메서드 선택과 API 설계
가장 단순한 이미지, 정적인 텍스트 문서와 같은 단순한 정적 데이터(쿼리 파라미터가 사용되지 않아도 되는 상황)를 조회할 때에는 일반적으로 GET 메서드만을 사용해 리소스를 조회한다. 동적 데이터를 조회하는 경우에는 GET 메세지의 요청 대상에 쿼리 파라미터가 추가하기만 하면 된다.

한편, HTML Form을 통해 데이터를 전송하는 방법도 있다. 그러나 HTML Form은 GET과 POST로 사용할 수 있는 메서드가 제약된다. 폼을 통해 데이터를 등록, 처리하는 요청 메세지에는 POST 메서드가 사용되며 Content-Type: application/x-www-form-urlencoded 헤더가 추가된다. 또한 메세지 본문에 데이터가 쿼리 파라미터 타입으로 작성된다.

HTML Form은 GET 메서드도 사용할 수 있다. 그러나 메세지 내 요청 대상이 리소스 변경이 발생할 가능성이 있는 경로를 포함하지 않도록 주의해야 한다. 이 경우, 폼의 기능은 클라이언트로부터 입력된 데이터로 필터링해서 조회하는 역할로 구현해야 할 것이다.

폼에서 단순한 자료형 데이터가 아닌 바이너리 파일을 입력받아 전송해야 할 경우도 발생하는데, 폼 내부에 enctype="multipart/form-data"를 추가한다. 요청 메세지에는 Content-Type: multipart/form-data; boundary=-----XXX 헤더가 추가되며, 메세지 바디에서 boundary를 통해 폼에서 받아오는 모든 데이터를 구분한다.

마지막으로 HTTP API를 통해 데이터를 전송하는 방법이 있다. 요청 메세지에 Content-Type: application/json 헤더를 추가해야 하며, HTTP 주요 메서드를 통한 API를 설계해 데이터를 주고받는 방식이다.

설계 방식은 크게 POST 기반 등록(컬렉션), PUT 기반 등록(스토어)으로 나눈다. POST 기반 등록은 클라이언트가 보내는 리소스가 등록된 URI를 서버가 생성해준다. POST /members?name=park&age=30 HTTP/1.1 처럼 클라이언트가 요청 라인을 보내면 HTTP/1.1 201 Created 상태 라인과 함께 Location: /members/100이라는 헤더를 추가로 보낸다. 여기서 /100이 클라이언트가 쿼리 파라미터로 보냈던 리소스가 등록된 URI이자 회원 번호로 인식할 수 있다.

반면 PUT 기반 등록은 클라이언트가 리소스 URI를 사전에 알고 있어야 서버로 데이터를 전송할 수 있다. PUT은 요청 메세지의 내용으로 특정 URI의 리소스를 덮어 쓰는 기능이기 때문에 어찌보면 당연하다.

HTML FORM으로도 API를 설계할 수 있지만 GET, POST로 메서드가 제한되므로 control URL을 추가해 원하는 기능을 구현할 수 있다.
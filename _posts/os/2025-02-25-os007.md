---
layout: single
title:  "입출력 시스템"
folder: "os"
categories:
  - operatingsystem
permalink: categories/operatingsystem/os007
tags: OS
toc: true
toc_sticky: true
sidebar_main: true
published: true
---

## 직접 메모리 접근, 메모리 맵 입출력
초기 컴퓨터 시스템은 CPU가 입출력 명령을 만나면 입출력장치에서 직접 데이터를 가져오는 방식이었습니다. 입출력장치를 포함한 다양한 주변장치들은 메인보드 내 시스템 버스(FSB)를 사용하기 때문에 내부 버스(BSB)를 사용하는 필수장치보다 속도가 느렸고, CPU는 입출력 정보를 받을 때까지 다른 작업을 수행할 수 없었습니다.

기술이 발전하면서 다양한 주변장치가 개발됨에 따라 CPU는 모든 주변장치의 입출력을 <span style="color: rgb(3, 150, 150); font-weight: bold;">`입출력 제어기(I/O Controller)`</span>에 맡기는 구조로 변경되었습니다. 입출력 제어기는 메인 버스와 입출력 버스 2개의 채널로 연결되어 필수장치와 주변장치 사이에서 입출력 작업을 담당하게 되었습니다.

전통적인 방식에서 메모리는 오직 CPU의 명령에 따라 작동했는데, 전체 입출력 작업을 입출력 제어기가 수행하게 되었으므로 입출력 제어기에도 CPU의 도움없이 직접 메모리에 접근할 수 있는 권한이 필요했습니다. 이를 <span style="color: rgb(3, 150, 150); font-weight: bold;">`직접 메모리 접근(Direct Memory Access)`</span>이라 합니다. 입출력 제어기는 자신과 연결된 주변장치 중 어느 채널의 데이터를 메모리에 보내고 받을지 선택 후, <span style="color: rgb(3, 150, 150); font-weight: bold;">`DMA 제어기`</span>를 통해 메모리에 직접 접근하여 데이터를 올리거나 가져올 수 있게 되었습니다.

이후 CPU가 작업하는 메모리 공간과 DMA 제어기가 데이터를 옮기는 공간을 분리하여 메모리를 운영할 필요가 있었고, 해당 방식을 <span style="color: rgb(3, 150, 150); font-weight: bold;">`메모리 맵 입출력(Memory Mapped I/O)`</span>이라고 합니다. 메모리 맵 입출력에서는 메모리의 주소 공간 중 일부를 DMA 제어기에 할당해 서로의 작업 공간이 겹치는 것을 막습니다.

## 인터럽트의 종류
인터럽트는 크게 내부 인터럽트, 외부 인터럽트, 시그널로 나눌 수 있습니다.

숫자를 0으로 나누거나 자신의 주소 공간을 벗어나는 작업을 하는 등의 프로세스 및 프로그래밍 오류와 관련된 인터럽트를 <span style="color: rgb(3, 150, 150); font-weight: bold;">`내부 인터럽트`</span>라고 합니다. 내부 인터럽트는 \'동기 인터럽트\', \'예외\'라고도 부릅니다.

\'비동기 인터럽트\', \'하드웨어 인터럽트\'라고도 불리는 <span style="color: rgb(3, 150, 150); font-weight: bold;">`외부 인터럽트`</span>는 입출력장치로부터 오는 인터럽트나 전원 이상, 기계적인 오류 등에 의해 발생하는 인터럽트를 포함하는 인터럽트입니다. 앞서 작성한 DMA 제어기가 발생시키는 입출력 신호도 외부 인터럽트의 한 종류입니다.

<span style="color: rgb(3, 150, 150); font-weight: bold;">`시그널`</span>은 사용자가 임의로 발생시키는 인터럽트입니다. \'Ctrl + C\' 명령어처럼 사용자가 발생시킬 수 있는 자발적인 인터럽트입니다.

인터럽트가 발생하면 해당 인터럽트를 인터럽트 벡터에 기록하고 인터럽트 컨트롤러를 통해 처리 순서를 결정한 후, 벡터에 기록된 인터럽트 번호에 대응되는 함수인 인터럽트 핸들러를 통해 순차적으로 처리된다고 설명했습니다. 이때 인터럽트 번호는 내부, 외부, 시그널 인터럽트 순서대로 0번부터 할당됩니다.

외부 인터럽트는 주로 입출력 인터럽트인 경우가 많은데, 이때 사용되는 <span style="color: rgb(3, 150, 150); font-weight: bold;">`IRQ(Interrupt Request)`</span> 번호는 인터럽트 번호가 아닌 입출력 장치마다 배정된 임의의 번호입니다. 실제로 IRQ 0번은 인터럽트 번호 32번이며, 0번부터 31번까지의 인터럽트 번호는 내부 인터럽트가 우선적으로 배정받습니다.

정리하면 IRQ가 인터럽트 번호와 일대일 대응되는 것은 사실이나, 똑같은 숫자 번호를 가지는 것은 아닙니다.
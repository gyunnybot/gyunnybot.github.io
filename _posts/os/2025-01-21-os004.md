---
layout: single
title:  "메모리 분할 방식"
folder: "os"
categories:
  - operatingsystem
permalink: categories/operatingsystem/os004
tags: OS
toc: true
toc_sticky: true
sidebar_main: true
published: true
---

## 메모리 분할 방식 개요
물리적인 메모리(RAM)의 크기에 상관없이 프로세스가 실행될 수 있도록 하는 기술을 <span style="color: rgb(3, 150, 150); font-weight: bold;">`가상 메모리`</span>라고 합니다. 물리 메모리와 하드 디스크의 스왑 영역을 합쳐서 가상 주소 공간을 할당하고, 실제 물리 메모리 주소와 일대일로 대응되는 <span style="color: rgb(3, 150, 150); font-weight: bold;">`매핑 테이블`</span>을 생성하여 메모리 위에서 프로세스를 실행시키는 기술입니다.

CPU의 시분할 방식은 실제로 프로세스가 동시에 실행되는 것이 아니라 빠른 속도로 문맥 교환을 거쳐 마치 동시에 실행되는 착각을 불러일으키는 방법입니다. 마찬가지로 실행 중인 프로세스의 부분만 적절히 분할하여 메모리에 올려두고, 나머지는 스왑 영역에서 대기하여 스왑 인, 스왑 아웃 과정을 거쳐서 전체 프로세스를 실행시키는 원리를 <span style="color: rgb(3, 150, 150); font-weight: bold;">`메모리 오버레이`</span>라고 부릅니다.

물리 메모리를 분할하는 방식에는 고정 분할 기법을 사용한 <span style="color: rgb(3, 150, 150); font-weight: bold;">`페이징`</span> 기법과 프로세스 크기별로 분할하는 <span style="color: rgb(3, 150, 150); font-weight: bold;">`세그먼테이션`</span> 기법이 있습니다. 각 기법은 장단점이 있으며, 현재는 두 기법의 장점만을 가진 세그먼테이션-페이징 혼용 기법이 주로 사용되고 있습니다.

## 페이징 기법
페이징 기법은 물리 주소 공간을 차례대로 같은 크기로 나누어 사용합니다. 분할된 가상 주소 공간의 크기와 물리 주소 공간의 크기가 같고, 페이지 테이블에 의해 **일대일로 매핑**됩니다. 하나의 프로세스도 분할되어 처리되기 때문에 전체 메모리 공간을 효율적으로 사용할 수 있지만, 내부 단편화 문제가 남아있으며 실행되는 프로세스가 차지하는 가상 주소 공간이 커짐에 따라 페이지 테이블의 크기도 증가하는 단점이 있습니다.

페이지 테이블은 일반적으로 메모리의 운영체제 영역에 저장되는 데이터베이스입니다. 따라서 테이블의 크기가 너무 커져버리게 되면 실제 프로세스가 사용할 수 있는 메모리 영역이 줄어들게 됩니다. 이처럼 사용할 수 있는 영역이 줄어들 경우, 페이지 테이블 또한 스왑 영역으로 옮겨서 관리할 수 있습니다. 매핑 방식에 따라 직접 매핑, 연관 매핑, 집합-연관 매핑, 역 매핑으로 나눌 수 있습니다.

<span style="color: rgb(3, 150, 150); font-weight: bold;">`직접 매핑`</span>은 운영체제 영역에 페이지 테이블이 저장된 방식입니다. 데이터 탐색에 O(1)의 속도로 찾을 수 있습니다.

<span style="color: rgb(3, 150, 150); font-weight: bold;">`연관 매핑`</span>은 페이지 테이블이 전부 스왑 영역에 저장된 방식으로, 일부 테이블의 레코드를 무작위로 뽑아 **변환 색인 버퍼(TLB)**를 형성한 후 매핑을 진행합니다. 색인 버퍼는 배열처럼 연결된 자료구조가 아니므로 데이터 탐색에 O(N)의 속도가 걸립니다. 테이블에 원하는 데이터가 없을 경우(TLB 미스), 스왑 영역으로 내려가 전체를 탐색해야 합니다. 페이지 테이블 전체가 스왑 영역에 있으므로 사용할 수 있는 메모리 영역은 늘어나지만, 탐색 시간이 직접 매핑에 비해 느립니다.

<span style="color: rgb(3, 150, 150); font-weight: bold;">`집합-연관 매핑`</span>은 스왑 영역에 저장된 페이지 테이블을 일정 구간의 집합으로 묶어서 관리하는 방식입니다. 현재 메모리에 올라와 있는 부분 집합을 선택하면 데이터를 매우 빠른 속도(O(1))로 찾을 수 있습니다. 하지만 집합 테이블을 따로 생성해야 하는 단점이 있습니다.

<span style="color: rgb(3, 150, 150); font-weight: bold;">`역 매핑`</span>은 가상 주소의 분할 단위인 페이지가 아닌 물리 주소의 프레임으로 분할된 테이블을 사용하는 기법입니다. 각 프레임을 할당하는 프로세스의 아이디와 페이지 번호로 테이블이 구성되기 때문에 프로세스의 수와 상관없이 테이블의 크기가 일정하게 유지됩니다. 하지만 연관 매핑처럼 페이지 테이블 전체를 살펴봐야 하므로 데이터 검색에 취약합니다.

## 세그먼테이션-페이징 혼용 기법
세그먼테이션 기법은 물리 주소 공간을 프로세스의 크기로 나누어 사용합니다. 메모리를 프로세스 단위로 관리하기 때문에 테이블이 작고 단순하다는 장점이 있지만, 외부 단편화 문제가 발생합니다.

세그먼테이션-페이징 혼용 기법은 코드, 데이터, 스택 영역으로 나뉘는 프로세스의 각 영역에 주어진 권한을 비트로 표시하는 권한 비트를 사용합니다. 기존의 세그먼테이션 테이블에 권한 비트를 추가하여 우선적으로 메모리 오류(트랩)를 메모리 영역에서 검사한 후, 연관 매핑 방식으로 물리 메모리를 스왑 영역에서 처리하는 방식입니다.
---
layout: single
title:  "스레드와 병렬 처리"
folder: "os"
categories:
  - operatingsystem
permalink: categories/operatingsystem/3
toc: true
toc_sticky: true
sidebar_main: true
published: true
---

<br><br>

## 스레드란?
CPU는 메인보드에 탑재된 크리스털 오실레이터(Crystal Oscillator)의 주기적인 진동 신호를 기반으로 클록을 생성하여, 이를 기반으로 동작한다. 이때 덧셈 연산, 메모리 로드와 같이 CPU가 한 클록(Clock) 주기마다 수행할 수 있는 최소 실행 단위를 명령어(Instruction)라고 한다.

스레드(Thread)는 이러한 명령어들의 논리적인 실행 흐름을 나타내는 최소 단위로 정의된다. 분명 CPU는 한 번에 하나의 명령어만 실행할 수 있지만, 결국 특정 스레드에 소속된 명령어를 실행한다. 즉, CPU는 항상 어떤 \'스레드\'에 속한 명령어 흐름을 따라가며 실행하기 때문에 실행 \'흐름\'의 최소 단위는 명령어가 아니라 스레드라고 보는 것이 타당하다. 실제 대부분의 프로그램도 여러 개의 명령어로 구성되며, 단일 명령어로 구성된 프로그램은 거의 존재하지 않는다.

## 스레드 수준 병렬 처리
CPU의 성능을 향상시키는 방법 중 하나는 CPU의 핵심 기능을 가진 코어(Core)를 여러 개 두어 동시에 실행할 수 있는 스레드 수를 늘리는 것이다.

코어(physical core)는 실제로 명령어를 실행하는 물리적인 처리 단위이다. 여러 개의 코어를 사용하면 여러 스레드를 동시에 실행하여 병렬 처리가 가능해지는데, 이를 멀티코어 구조에 의한 스레드 수준 병렬 처리(TLP)라고 한다.

또 다른 스레드 수준 병렬 처리 기법으로 하드웨어 멀티스레딩(예: 인텔의 Hyper-Threading)이 있다. 하드웨어 멀티스레딩은 하나의 코어에 두 개 이상의 논리 프로세서를 제공하여, 서로 다른 스레드의 명령어들을 코어 내부 파이프라인에 섞어서 흘려보낼 수 있다.

예컨대 한 스레드가 메모리 대기 등으로 실행 유닛을 사용하지 못하는 사이에, 다른 스레드의 명령어를 대신 실행하는 방식으로 자원을 더 효율적으로 활용하는 것이다. 서로 다른 스레드의 명령어들이 같은 클럭 사이클에 서로 다른 파이프라인 단계에서 동시에 실행될 수 있으므로, 단일 코어에서도 제한적인 형태의 병렬 실행이 이루어진다고 볼 수 있다.

당연하게도 위에서 설명한 두 가지 병렬 처리 기법은 동시에 구현될 수 있다. 코어를 여러 개 사용하면서 각 코어 내에 논리 프로세서가 여러 개라면, 이는 멀티코어 구조와 하드웨어 멀티스레딩 방식을 같이 사용하는 꼴이 된다.

## 명령어 수준 병렬 처리
CPU는 한 스레드 내부의 명령어 집합을 더 빠르게 실행하기 위해 명령어 수준 병렬 처리(ILP) 기법을 사용할 수 있다. 대표적인 예가 파이프라이닝(Pipelining)과 슈퍼스칼라(Superscalar)이다.

파이프라이닝은 하나의 명령어 실행을 가져오기(IF), 해석(ID), 실행(EX), 메모리 접근(MEM), 결과 기록(WB)과 같은 여러 단계로 나누고, 각 파이프라인 단계가 서로 다른 명령어를 동시에 처리하여 한 스레드의 명령어 흐름을 더 빠르게 흘려보내는 방식이다. 결국, 한 클럭 사이클 동안 여러 명령어가 각기 다른 단계에서 병렬로 진행되므로 전체 처리 효율이 증가하게 된다.

슈퍼스칼라 기법은 파이프라이닝에 더해, 하나의 코어 안에 여러 개의 실행 파이프라인을 두고, 한 스레드에서 나온 독립적인 명령어들을 한 클럭에 여러 개까지 동시에 발행, 실행할 수 있도록 설계한 구조이다. 오늘날의 범용 CPU들은 대부분 파이프라이닝과 슈퍼스칼라 구조를 함께 사용하여 한 코어에서 높은 명령어 수준 병렬성(ILP)을 끌어낸다.
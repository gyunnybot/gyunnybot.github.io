---
layout: single
title:  "인터럽트 이해하기"
folder: "os"
categories:
  - operatingsystem
permalink: categories/operatingsystem/os002
tags: OS
toc: true
toc_sticky: true
sidebar_main: true
published: true
---

## 직접 메모리 접근, 메모리 맵 입출력
초기 컴퓨터 시스템은 주변장치가 많지 않았고 CPU와 메모리의 속도도 빠르지 않았다. CPU가 입출력 명령을 만나면 직접 입출력장치에서 데이터를 가져오는 방식(Polling)이었다. 입출력장치를 포함한 다양한 주변장치들은 메인보드 내 시스템 버스(FSB)와 연결되었기 때문에 내부 버스(BSB)를 사용하는 CPU 내부보다 속도가 느렸고, CPU는 입출력 정보를 받을 때까지 다른 작업을 수행할 수 없었다.

기술이 발전하면서 다양한 주변장치가 개발됨에 따라, 모든 입출력을 입출력 제어기(I/O Controller)에 맡기는 구조로 바뀌었다. 입출력 제어기는 메인 버스와 입출력 버스 2개의 채널로 연결되어 필수장치와 주변장치 간의 속도 차이를 완화해 작업 효율을 높였다.

전통적인 방식에서 메모리는 오직 CPU의 명령에 따라 작동했는데, 전체 입출력 작업을 입출력 제어기가 수행하게 되었으므로 입출력 제어기 또한 CPU처럼 메모리에 직접 접근할 수 있는 권한이 필요했다. 이를 직접 메모리 접근(Direct Memory Access)이라 한다. 입출력 제어기는 자신과 연결된 주변장치 중 어느 채널의 데이터를 메모리에 보내고 받을지 선택 후, DMA 제어기를 통해 메모리에 직접 접근하여 데이터를 올리거나 가져올 수 있게 되었다.

이후 CPU가 작업하는 메모리 공간과 DMA 제어기가 입출력할 데이터 저장 공간을 분리하여 메모리를 운영할 필요가 있었고, 해당 방식을 메모리 맵 입출력(Memory Mapped I/O)이라고 한다. 메모리 맵 입출력에서는 메모리의 주소 공간 중 일부를 DMA 제어기에만 할당해 서로의 작업 공간이 겹치는 것을 막는다.

## 인터럽트란?
CPU가 작업을 실행하는 도중 입출력 완료 신호와 같은 이벤트가 발생(Event Driven)하면 CPU가 현재 진행 중인 작업을 일시적으로 중단하고 해당 요청을 우선 처리한 후 원래 작업으로 복귀하는데, 이를 인터럽트(Interrupt)라고 한다. 컴퓨터 과학에서 인터럽트는 꼭 입출력에 국한된 개념이 아니라 기존의 진행을 방해하는 의미로도 광범위하게 쓰이는 용어이다.

## 인터럽트 처리 루틴
컴퓨터 시스템에서는 다양한 인터럽트가 존재하고 또 동시에 여러 개의 인터럽트가 발생할 수 있기 때문에 Array 방식의 인터럽트 벡터(Interrupt Vector)를 사용해 여러 인터럽트를 하나로 묶어서 처리한다.

먼저 인터럽트 컨트롤러(Interrupt Controller)로 벡터에 저장된 인터럽트의 우선순위를 고려하여 처리 순서를 결정한다. 이후 각 인터럽트가 가진 인터럽트 번호에 대응되는 함수인 인터럽트 핸들러(Interrupt Handler)를 컨트롤러가 정해준 순서대로 실행하여 인터럽트를 처리한다.

## 인터럽트의 종류
인터럽트는 크게 내부 인터럽트, 외부 인터럽트, 시그널로 나눌 수 있다.

숫자를 0으로 나누거나 자신의 주소 공간을 벗어나는 작업을 하는 등의 CPU 작업 및 프로그래밍 오류와 관련된 인터럽트를 내부 인터럽트라고 한다. 실행 중인 작업을 이루는 명령어로 인해 발생하는 인터럽트로 \'동기적 인터럽트\', \'예외\'라고도 한다. 특히, 내부 인터럽트 중 시스템 콜에 의한 인터럽트를 \'소프트웨어 인터럽트\'라고 부른다.

\'비동기 인터럽트\', \'하드웨어 인터럽트\'라고도 불리는 외부 인터럽트는 주로 입출력장치로부터 오는 인터럽트나 전원 이상, 기계적인 오류 등에 의해 발생하는 인터럽트를 일컫는다. 앞서 언급한 DMA 제어기가 발생시키는 입출력 완료 신호도 외부 인터럽트의 한 종류다.

시그널은 \'Ctrl + C\' 명령어처럼 사용자가 임의로 발생시킬 수 있는 인터럽트를 말한다.

## 인터럽트 번호
앞서 인터럽트가 발생하면 해당 인터럽트 주소를 인터럽트 벡터에 기록하고 인터럽트 컨트롤러를 통해 처리 순서를 결정한 후, 벡터에 기록된 인터럽트 번호에 대응되는 함수인 인터럽트 핸들러를 통해 순차적으로 처리된다고 했다. 이때 인터럽트 번호는 내부, 외부, 시그널 인터럽트 순서대로 미리 할당되어 있다.

외부 인터럽트는 주로 입출력 인터럽트인 경우가 많은데, 이때 사용되는 IRQ(Interrupt Request) 번호는 인터럽트 번호가 아니라, 입출력 장치를 구분하기 위해 배정된 임의의 번호다. 실제로 IRQ 0번(타이머)은 인터럽트 번호 32번이며, IRQ 1번(키보드)이 인터럽트 번호 33번에 대응된다. 0번부터 31번까지의 인터럽트 번호는 내부 인터럽트가 우선적으로 배정받는다.

요컨대 IRQ가 인터럽트 번호와 일대일 대응되는 것은 사실이나, 똑같은 숫자 번호를 가지는 것은 아니므로 인터럽트 발생 시 주의 깊게 살펴봐야 한다.